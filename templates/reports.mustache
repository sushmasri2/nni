{{!
    Reports template - reports.mustache
}}
<div id="reports-container">
    <!-- Header -->
    <div class="reports-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2 class="mb-2">{{report_title}} {{#str}}report, local_dashboardv2{{/str}}</h2>
                <p class="text-muted mb-0">
                    {{#str}}welcome, local_dashboardv2{{/str}}, {{user_fullname}} 
                    <span class="role-badge">({{role_display}})</span>
                </p>
            </div>
            <div class="col-md-4 text-right">
                <a href="{{dashboard_url}}" class="btn btn-secondary">
                    <i class="fa fa-arrow-left"></i> {{#str}}back_to_dashboard, local_dashboardv2{{/str}}
                </a>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="reports-filters-section mb-4">
        <div class="card">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        {{#is_spoc}}
                            {{#has_area_managers}}
                                <div class="form-group mb-0">
                                    <label for="selected_area_manager">{{#str}}select_area_manager, local_dashboardv2{{/str}}</label>
                                    <select name="selected_area_manager" id="selected_area_manager" class="form-control">
                                        <option value="">{{#str}}choose_area_manager, local_dashboardv2{{/str}}</option>
                                        {{#area_managers}}
                                        <option value="{{username}}" {{#selected}}selected{{/selected}}>
                                            {{fullname}} ({{username}})
                                        </option>
                                        {{/area_managers}}
                                    </select>
                                </div>
                            {{/has_area_managers}}
                        {{/is_spoc}}

                        {{#is_area_manager}}
                            {{#has_nutrition_officers}}
                                <div class="form-group mb-0">
                                    <label for="selected_nutrition_officer">{{#str}}select_nutrition_officer, local_dashboardv2{{/str}}</label>
                                    <select name="selected_nutrition_officer" id="selected_nutrition_officer" class="form-control">
                                        <option value="">{{#str}}choose_nutrition_officer, local_dashboardv2{{/str}}</option>
                                        {{#nutrition_officers}}
                                        <option value="{{username}}" {{#selected}}selected{{/selected}}>
                                            {{fullname}} ({{username}})
                                        </option>
                                        {{/nutrition_officers}}
                                    </select>
                                </div>
                            {{/has_nutrition_officers}}
                        {{/is_area_manager}}
                    </div>
                    <div class="col-md-5">
                        <div class="form-group mb-0">
                            <label for="search-report">{{#str}}search_users, local_dashboardv2{{/str}}</label>
                            <input type="text" id="search-report" class="form-control" placeholder="{{#str}}search_users, local_dashboardv2{{/str}}" aria-label="{{#str}}search_users, local_dashboardv2{{/str}}">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-end h-100">
                            <button id="download-report" class="btn btn-primary ml-auto">
                                <i class="fa fa-download"></i> {{#str}}download_report, local_dashboardv2{{/str}}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Summary -->
    <div class="reports-summary mb-4">
        <div class="alert alert-info">
            <h5 class="mb-2">{{#str}}report_summary, local_dashboardv2{{/str}}</h5>
            <p class="mb-0">
                {{#str}}total_records, local_dashboardv2{{/str}}: <strong>{{total_records}}</strong> users
                {{#selected_area_manager}}
                | {{#str}}filtered_by_area_manager, local_dashboardv2{{/str}}: <strong>{{selected_area_manager}}</strong>
                {{/selected_area_manager}}
                {{#selected_nutrition_officer}}
                | {{#str}}filtered_by_nutrition_officer, local_dashboardv2{{/str}}: <strong>{{selected_nutrition_officer}}</strong>
                {{/selected_nutrition_officer}}
            </p>
        </div>
    </div>

    <!-- Report Data Table -->
    <div class="reports-table-container">
        {{#has_report_data}}
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover reports-data-table mb-0">
                            <thead class="thead-dark">
                                <tr>
                                    <th>{{#str}}username, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}fullname, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}email, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}regional_head, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}area_manager, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}nutrition_officer, local_dashboardv2{{/str}}</th>
                                    
                                    {{#is_newregistrations}}
                                    <th>{{#str}}registration_date, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}first_access, local_dashboardv2{{/str}}</th>
                                    {{/is_newregistrations}}
                                    
                                    {{#is_courseenrolments}}
                                    <th>{{#str}}enrolment_date, local_dashboardv2{{/str}}</th>
                                    {{/is_courseenrolments}}
                                    
                                    {{#is_coursecompletions}}
                                    <th>{{#str}}completion_count, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}completion_date, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}completion_progress, local_dashboardv2{{/str}}</th>
                                    {{/is_coursecompletions}}
                                    
                                    {{#is_activeusers}}
                                    <th>{{#str}}last_login, local_dashboardv2{{/str}}</th>
                                    <th>{{#str}}activity_count, local_dashboardv2{{/str}}</th>
                                    {{/is_activeusers}}
                                    
                                    {{#is_inactiveusers}}
                                    <th>{{#str}}last_activity, local_dashboardv2{{/str}}</th>
                                    {{/is_inactiveusers}}
                                    
                                    <th>{{#str}}module, local_dashboardv2, 1{{/str}}</th>
                                    <th>{{#str}}module, local_dashboardv2, 2{{/str}}</th>
                                    <th>{{#str}}module, local_dashboardv2, 3{{/str}}</th>
                                    <th>{{#str}}module, local_dashboardv2, 4{{/str}}</th>
                                    <th>{{#str}}module, local_dashboardv2, 5{{/str}}</th>
                                    <th>{{#str}}module, local_dashboardv2, 6{{/str}}</th>
                                    <th>{{#str}}module, local_dashboardv2, 7{{/str}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#report_data}}
                                <tr>
                                    <td><strong>{{username}}</strong></td>
                                    <td>{{fullname}}</td>
                                    <td>{{email}}</td>
                                    <td>{{regional_head}}</td>
                                    <td>{{area_manager}}</td>
                                    <td>{{nutrition_officer}}</td>
                                    
                                    {{#is_newregistrations}}
                                    <td>{{timecreated}}</td>
                                    <td>{{firstaccess}}</td>
                                    {{/is_newregistrations}}
                                    
                                    {{#is_courseenrolments}}
                                    <td>{{enrolment_date}}</td>
                                    {{/is_courseenrolments}}
                                    
                                    {{#is_coursecompletions}}
                                    <td><span class="badge badge-success">{{completion_count}}</span></td>
                                    <td>{{completion_date}}</td>
                                    <td>{{completion_progress}}</td>
                                    {{/is_coursecompletions}}
                                    
                                    {{#is_activeusers}}
                                    <td>{{last_login}}</td>
                                    <td><span class="badge badge-info">{{activity_count}}</span></td>
                                    {{/is_activeusers}}
                                    
                                    {{#is_inactiveusers}}
                                    <td>{{last_activity}}</td>
                                    {{/is_inactiveusers}}
                                    
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_1}}%" aria-valuenow="{{module_1}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_1}}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_2}}%" aria-valuenow="{{module_2}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_2}}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_3}}%" aria-valuenow="{{module_3}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_3}}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_4}}%" aria-valuenow="{{module_4}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_4}}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_5}}%" aria-valuenow="{{module_5}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_5}}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_6}}%" aria-valuenow="{{module_6}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_6}}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar" role="progressbar" style="width: {{module_7}}%" aria-valuenow="{{module_7}}" aria-valuemin="0" aria-valuemax="100">
                                                {{module_7}}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {{/report_data}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {{/has_report_data}}
        
        {{^has_report_data}}
            <div class="card">
                <div class="card-body text-center">
                    <div class="no-data py-5">
                        <i class="fa fa-chart-bar fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">{{#str}}no_report_data, local_dashboardv2{{/str}}</h5>
                        <p class="text-muted">{{#str}}no_data_description, local_dashboardv2{{/str}}</p>
                    </div>
                </div>
            </div>
        {{/has_report_data}}
    </div>
</div>