define("local_dashboardv2/feedback",["jquery","core/ajax","local_edwiserreports/select2"],(function($,Ajax){const SELECTOR={PANEL:"#feedbackmod",TABLEAREA:".tablearea",COURSE:".course-select",MODULE:".feedback-select",COHORT:".user-select",MODULENAME:"#feedbackname"};let filter={course:0,cohort:0,dir:$("html").attr("dir"),profilefield:""};function fn_get_table_names(){var _filter$group;$(SELECTOR.MODULE).empty(),Ajax.call([{methodname:"local_dashboardv2_get_feedbacks",args:{profilefield:filter.profilefield,courseid:filter.course,username:filter.cohort,moduleid:null!==(_filter$group=filter.group)&&void 0!==_filter$group?_filter$group:0}}])[0].then((response=>{if(response.feedbacks.forEach((function(cl){$(SELECTOR.MODULE).append($("<option></option>").attr("value",cl.id).text(cl.name+"("+cl.section+")").attr("title",cl.section).attr("data-cmid",cl.cmid))})),void 0!==filter.group&&0!==filter.group?$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULE)).val(filter.group):$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULE)).val(response.feedbacks[0].id),filter.group=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULE)).val(),0===response.report.length)return $(SELECTOR.TABLEAREA).html('<div class="alert alert-dark m-5">The feedback has not been published yet.</div>'),$(".fp-btn").attr("href","").css({"pointer-events":"none",opacity:.3}),void $("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULENAME)).html("");!function(response){let totalUsers=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(void 0===filter.group)return;let para="?id="+$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULE)).find("option:selected")[0].dataset.cmid;$(".fp-btn").attr("href",M.cfg.wwwroot+"/mod/feedback/show_entries.php"+para),$(".fp-btn").css({"pointer-events":"auto",opacity:1}),$(SELECTOR.PANEL).find(SELECTOR.FORMFILTER).val(JSON.stringify(filter)),$(SELECTOR.TABLEAREA).html(""),generateTable(response),$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULENAME)).html("Total User: <b>"+totalUsers+"</b>")}(response.report,response.totalusers)}))}function generateTable(data){let sForm='<table class="table table-striped table-hover">';sForm+='<thead class="table-light">',sForm+="<tr>",sForm+="<th>Reason</th><th>Excellent</th><th>Good</th><th>Average</th>",sForm+="<th>Needs Improvement</th><th>Average Rating</th></tr>",sForm+="</thead><tbody>",data.forEach((function(cl){let spanClass="";"9999"!==cl.id&&("Excellent"===cl.final_category?spanClass="badge bg-success text-light":"Good"===cl.final_category?spanClass="badge bg-info text-light":"Average"===cl.final_category?spanClass="badge bg-primary text-light":"Needs Improvement"===cl.final_category&&(spanClass="badge bg-danger text-light"));const spanWrapper='<span class="'+spanClass+'">'+cl.final_category+"</span>";sForm+="<tr><td>"+cl.question+"</td>",sForm+='<td class="text-center">'+cl.excellent+"</td>",sForm+='<td class="text-center">'+cl.good+"</td>",sForm+='<td class="text-center">'+cl.average+"</td>",sForm+='<td class="text-center">'+cl.needs_improvement+"</td>",sForm+='<td class="text-center">'+spanWrapper+' <span class="d-block" style="font-size:12px;">('+cl.avg_score+")</span></td></tr>"})),sForm+="</tbody></table>",$(SELECTOR.TABLEAREA).html(sForm)}return{init:function(){0!==$(SELECTOR.COURSE).length&&($(SELECTOR.PANEL+" .singleselect").select2(),$("body").on("change","".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT),(function(){filter.course=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COURSE)).val(),filter.group=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULE)).val(),filter.profilefield=$(this).attr("data-for"),filter.cohort=$(this).val(),fn_get_table_names()})),$("body").on("change","".concat(SELECTOR.PANEL," ").concat(SELECTOR.COURSE),(function(){filter.course=parseInt($(this).val()),filter.cohort=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT)).val(),filter.profilefield=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT)).attr("data-for"),filter.group=0,fn_get_table_names()})),$("body").on("change","".concat(SELECTOR.PANEL," ").concat(SELECTOR.MODULE),(function(){filter.course=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COURSE)).val(),filter.cohort=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT)).val(),filter.profilefield=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT)).attr("data-for"),filter.group=parseInt($(this).val()),fn_get_table_names()})),filter.course=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COURSE)).val(),filter.cohort=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT)).val(),filter.profilefield=$("".concat(SELECTOR.PANEL," ").concat(SELECTOR.COHORT)).attr("data-for"),fn_get_table_names())}}}));

//# sourceMappingURL=feedback.min.js.map